<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Blog Post</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, textarea { width: 100%; padding: 10px; margin: 10px 0; }
    button { padding: 10px 20px; cursor: pointer; }
    #blogForm { display: none; }
  </style>
</head>
<body>
  <h1 id="pageTitle">Authentication Required</h1>

  <div id="loginBox">
    <input type="password" id="passwordInput" placeholder="Enter Password" />
    <button onclick="checkPassword()">Login</button>
  </div>

  
  <form id="blogForm">
    <input type="text" name="title" placeholder="Post Title" required /><br />
    <textarea name="content" placeholder="Write your blog..." required></textarea><br />
    <input type="text" name="author" placeholder="Author Name" required /><br />
    <input type="text" name="tags" placeholder="Tags (comma separated)" /><br />
    <label>Upload Image:</label>
    <input type="file" id="imageUpload" accept="image/*" /><br />
    <input type="text" name="image" id="imageURL" placeholder="Image URL" readonly /><br />
    <img id="previewImage" style="max-width: 100%; display: none;" />
    <input type="text" name="category" placeholder="Category" /><br />
    <input type="text" name="date" placeholder="Date (DD-MM-YYYY)" /><br />
    <input type="text" name="slug" placeholder="Slug (URL friendly name)" /><br />
    <textarea name="description" placeholder="Short description of the blog..."></textarea><br />
    <input type="text" name="keywords" placeholder="Keywords (comma separated)" /><br />
    <button type="submit">Publish</button>
  </form>

  <script>
    const secretPassword = 'sanjupurdhani@gmail.com';

    function showToast(message, type = 'success') {
  const toast = document.createElement('div');
  toast.textContent = message;
  toast.style.position = 'fixed';
  toast.style.bottom = '30px';
  toast.style.right = '30px';
  toast.style.padding = '15px 20px';
  toast.style.backgroundColor = type === 'success' ? '#4caf50' : '#f44336';
  toast.style.color = '#fff';
  toast.style.borderRadius = '8px';
  toast.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
  toast.style.zIndex = 1000;
  toast.style.opacity = '0';
  toast.style.transition = 'opacity 0.3s ease-in-out';

  document.body.appendChild(toast);

  setTimeout(() => {
    toast.style.opacity = '1';
  }, 100);

  setTimeout(() => {
    toast.style.opacity = '0';
    setTimeout(() => toast.remove(), 500);
  }, 2500);
}


    function checkPassword() {
      const input = document.getElementById('passwordInput').value;
      if (input === secretPassword) {
        document.getElementById('blogForm').style.display = 'block';
        document.getElementById('loginBox').style.display = 'none';
        document.getElementById('pageTitle').innerText = 'Create New Blog Post';
      } else {
        alert('Incorrect password. Try again.');
      }
    }

    document.getElementById('blogForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const form = new FormData(this);

      const postData = {
        title: form.get('title'),
        content: form.get('content'),
        author: form.get('author'),
        tags: form.get('tags'),
        image: form.get('image'),
        category: form.get('category'),
        date: form.get('date'),
        slug: form.get('slug'),
        description: form.get('description'),
        keywords: form.get('keywords'),
      };

      try {
  const response = await fetch('https://soulsavera.netlify.app/.netlify/functions/addPost', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(postData)
  });

  const result = await response.json();

  showToast(result.message || 'Blog published successfully!', 'success');

  // Redirect after short delay
  setTimeout(() => {
    window.location.href = '/blogs/index.html';
  }, 2000);

} catch (error) {
  showToast('Error submitting post.', 'error');
  console.error(error);
}

    });
  </script>
    <script>
  document.getElementById('imageUpload').addEventListener('change', async function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = async function () {
      const base64Data = reader.result.split(',')[1]; 
      const fileName = `${Date.now()}-${file.name}`;

      try {
        const res = await fetch('https://soulsavera.netlify.app/.netlify/functions/uploadImage', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            fileName,
            fileData: base64Data,
            mimeType: file.type
          })
        });

        const data = await res.json();
        if (res.ok) {
          document.getElementById('imageURL').value = data.url;
          document.getElementById('previewImage').src = data.url;
          document.getElementById('previewImage').style.display = 'block';
        } else {
          console.error(data);
          alert('Image upload failed.');
        }
      } catch (error) {
        console.error(error);
        alert('Error uploading image.');
      }
    };

    reader.readAsDataURL(file);
  });
</script>
</body>
</html>